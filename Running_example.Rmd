---
title: "TNFa GSE64233"
output: pdf_document
---

The file length_bias_analysis.R , the counts file and the Tx.len.file should be located in Counts_data folder within the working directory.
The output file is cnts_data_Pgenes.txt

```{r setup, include=FALSE}
source("length_bias_analysis.R")
```

## Step 1 : Filter genes
Create filtered counts file with genes that have at least 1.0 cpm in all replicates of at least one biological condition in the dataset, and have a length and GC content data.
The output is cnts_data_Pgenes file, this file is being use as a counts file input for the next steps.



```{r filter genes, warning=FALSE}
N.replicates <- 3
Conds <- list("control"=1:N.replicates, "treatment"=(N.replicates+1):(N.replicates*2))
Tx.LenFile <- "Counts_data/Hs_Ens_v96_APLen_forPCgenes_MaxTxLenForRest_plus_GCcontent.txt";
countsFile <- "Counts_data/GSE64233_Counts.txt"
DatasetTitle <- "TNFa_GSE64233"
identify_genes_with_leninfo_and_cpm_above_thresh (countsFile, Conds,N.samples.cutoff=N.replicates,
                                                  CPM.CUTOFF=1.0, Tx.LenFile,
                                                  DatasetTitle=DatasetTitle) 
```

## Step 2 : compare biological conditions
The count file is the filtered counts file from the previous step (cnts_data_Pgenes file) and it need to be located in the wd.
The output includes 2 files:
treatment_vs_control_analysis_results.txt
biological_conditions_analysis_plots.pdf

```{r Step 2: compare biological conditions, warning=FALSE}
countsFile.Pgenes <- ("TNFa_GSE64233_cnts_data_Pgenes.txt")
length_bias_analysis_compare_biological_conditions(countsFile.Pgenes, Tx.LenFile,
                                                   DatasetTitle=DatasetTitle,
                                                   X.lim=c(8, 15), Y.lim=c(-2,2)) 
```
## Step 3 : compare replicate samples 
The count file is the filtered counts file from the step 1 (cnts_data_Pgenes file) and it need to be located in the wd.
The analysis is on the treatment replicates. For control replicates set Rep.first.col to 2.
The output includes 2 files:
replicate_samples_analysis_results.txt
replicate_samples_analysis_plots.pdf

```{r Step 3: compare replicate samples (on treatment replicates),warning=FALSE}
Rep.first.col <- N.replicates + 2
length_bias_analysis_compare_replicate_samples(countsFile.Pgenes, Tx.LenFile,N.replicates=N.replicates,
                                               DatasetTitle=DatasetTitle, Rep.first.col=Rep.first.col,
                                               X.lim=c(8, 15), Y.lim=c(-3,3)) 
```
## Step 4 : compare biological and replicate samples after cqn normalization
The count file is the filtered counts file from the step 1 (cnts_data_Pgenes file) and it need to be located in the wd.
The analysis is on the treatment replicates. For control replicates set Rep.first.col to 2.
The output includes 4 files:
cqn_replicate_samples_analysis_results.txt
CQN_replicate_samples_analysis_plots.pdf
cqn_treatment_vs_control_analysis_results.txt
CQN_biological_conditions_analysis_plots.pdf

```{r Step 4: compare biological and replicate samples (on treatment replicates) after cqn normalization,warning=FALSE}

length_bias_analysis_cqn_normalization (countsFile.Pgenes,Tx.LenFile,N.replicates=N.replicates,
                                        DatasetTitle=DatasetTitle, Rep.first.col=Rep.first.col,
                                        X.lim=c(8, 15), Y.lim=c(-4,4)) 

```